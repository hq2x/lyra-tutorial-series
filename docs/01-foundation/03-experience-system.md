# Experience ç³»ç»Ÿï¼šLyra çš„æ¸¸æˆæ¨¡å¼æ ¸å¿ƒ

> æ·±å…¥ç†è§£ Lyra çš„ Experience ç³»ç»Ÿï¼ŒæŒæ¡æ¸¸æˆæ¨¡å¼åŠ¨æ€åˆ‡æ¢çš„æ ¸å¿ƒæœºåˆ¶

---

## ğŸ“‹ æœ¬æ–‡æ¦‚è§ˆ

åœ¨ä¼ ç»Ÿçš„ Unreal Engine é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ `GameMode`ã€`GameState` ç­‰ç±»æ¥å®šä¹‰æ¸¸æˆè§„åˆ™ã€‚ä½†å½“ä½ éœ€è¦åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æ”¯æŒå¤šç§ç©æ³•ï¼ˆæ¯”å¦‚å›¢é˜Ÿæ­»æ–—ã€å¤§é€ƒæ€ã€å¡”é˜²ç­‰ï¼‰æ—¶ï¼Œä¼ ç»Ÿæ–¹å¼ä¼šè®©ä»£ç å˜å¾—è‡ƒè‚¿ä¸å ªã€‚

Lyra å¼•å…¥çš„ **Experience ç³»ç»Ÿ**å½»åº•æ”¹å˜äº†è¿™ä¸€å±€é¢ã€‚å®ƒæ˜¯ Lyra æ¶æ„çš„æ ¸å¿ƒåˆ›æ–°ä¹‹ä¸€ï¼Œæä¾›äº†ä¸€ç§**æ•°æ®é©±åŠ¨ã€æ’ä»¶åŒ–ã€å¯çƒ­åˆ‡æ¢**çš„æ¸¸æˆæ¨¡å¼ç®¡ç†æ–¹æ¡ˆã€‚

æœ¬æ–‡å°†æ·±å…¥å‰–æ Experience ç³»ç»Ÿçš„è®¾è®¡å“²å­¦ã€å®ç°ç»†èŠ‚å’Œå®æˆ˜åº”ç”¨ã€‚

**é˜…è¯»æ”¶è·ï¼š**
- ç†è§£ Experience ç³»ç»Ÿçš„æ¶æ„è®¾è®¡
- æŒæ¡ Experience çš„åŠ è½½å’Œæ‰§è¡Œæµç¨‹
- å­¦ä¼šåˆ›å»ºè‡ªå®šä¹‰ Experience Definition
- ç†è§£ GameFeatureAction çš„ä½œç”¨å’Œå®ç°
- å®æˆ˜ï¼šæ„å»ºä¸€ä¸ªå®Œæ•´çš„æ¸¸æˆæ¨¡å¼

**å‰ç½®çŸ¥è¯†ï¼š**
- äº†è§£ Unreal Engine çš„ GameMode å’Œ GameState
- ç†Ÿæ‚‰ UE çš„ Asset Manager å’Œä¸»èµ„äº§ç³»ç»Ÿ
- é˜…è¯»è¿‡å‰ä¸¤ç¯‡æ–‡ç« ï¼ˆé¡¹ç›®æ¦‚è¿°ã€æ¨¡å—åŒ–ç»„ä»¶ï¼‰

---

## ğŸ¯ ä»€ä¹ˆæ˜¯ Experienceï¼Ÿ

### Experience çš„æ ¸å¿ƒæ¦‚å¿µ

**Experience** å¯ä»¥ç†è§£ä¸º"æ¸¸æˆä½“éªŒå®šä¹‰"ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªå®Œæ•´æ¸¸æˆæ¨¡å¼æ‰€éœ€çš„ä¸€åˆ‡ï¼š

- **æ¸¸æˆè§„åˆ™**ï¼šå›åˆåˆ¶è¿˜æ˜¯å®æ—¶ï¼Ÿæœ‰æ— å¤æ´»ï¼Ÿèƒœåˆ©æ¡ä»¶ï¼Ÿ
- **æ¸¸æˆå†…å®¹**ï¼šåœ°å›¾ã€è§’è‰²ã€æ­¦å™¨ã€UI
- **æ¸¸æˆç³»ç»Ÿ**ï¼šè¾“å…¥ç»‘å®šã€æŠ€èƒ½ç³»ç»Ÿã€é˜Ÿä¼ç³»ç»Ÿ
- **Game Features**ï¼šéœ€è¦åŠ è½½å“ªäº›æ’ä»¶

åœ¨ Lyra ä¸­ï¼Œåˆ‡æ¢ Experience å°±åƒåˆ‡æ¢"æ¸¸æˆç›’å­"ï¼š
- åŠ è½½ `ShooterCore` Experience â†’ è¿›å…¥ FPS å°„å‡»æ¨¡å¼
- åŠ è½½ `TopDownArena` Experience â†’ è¿›å…¥ä¿¯è§†è§’ç«æŠ€åœºæ¨¡å¼

### Experience vs ä¼ ç»Ÿ GameMode

| ç‰¹æ€§ | ä¼ ç»Ÿ GameMode | Lyra Experience |
|------|--------------|-----------------|
| **å®šä¹‰æ–¹å¼** | C++ æˆ–è“å›¾ç±» | Data Asset é…ç½® |
| **å†…å®¹ç»‘å®š** | ç¡¬ç¼–ç å¼•ç”¨ | åŠ¨æ€åŠ è½½ |
| **åˆ‡æ¢æˆæœ¬** | éœ€è¦é‡å¯å…³å¡ | è¿è¡Œæ—¶çƒ­åˆ‡æ¢ |
| **æ¨¡å—åŒ–** | éš¾ä»¥æ‹†åˆ† | æ’ä»¶åŒ–ç»„åˆ |
| **å¤šæ¨¡å¼æ”¯æŒ** | éœ€è¦å¤šä¸ª GameMode å­ç±» | å…±ç”¨ä¸€ä¸ª GameModeï¼Œåˆ‡æ¢ Experience |

**å…³é”®ä¼˜åŠ¿ï¼š**
1. **æ•°æ®é©±åŠ¨**ï¼šç­–åˆ’æ— éœ€ç¼–ç¨‹å³å¯é…ç½®æ–°æ¨¡å¼
2. **æ’ä»¶åŒ–**ï¼šåŠŸèƒ½æ¨¡å—å¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€å¤ç”¨
3. **åŠ¨æ€åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½å†…å®¹ï¼Œå‡å°‘å†…å­˜å ç”¨
4. **å›¢é˜Ÿåä½œ**ï¼šä¸åŒæ¨¡å¼çš„å¼€å‘äº’ä¸å¹²æ‰°

---

## ğŸ—ï¸ Experience ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç±»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ULyraExperienceDefinition                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ + GameFeaturesToEnable: TArray<FString>              â”‚  â”‚
â”‚  â”‚ + DefaultPawnData: ULyraPawnData*                    â”‚  â”‚
â”‚  â”‚ + Actions: TArray<UGameFeatureAction*>               â”‚  â”‚
â”‚  â”‚ + ActionSets: TArray<ULyraExperienceActionSet*>     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ ç®¡ç†åŠ è½½
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ULyraExperienceManagerComponent                 â”‚
â”‚  (Attached to AGameStateBase)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ - CurrentExperience: ULyraExperienceDefinition*      â”‚  â”‚
â”‚  â”‚ - LoadState: ELyraExperienceLoadState                â”‚  â”‚
â”‚  â”‚ - NumGameFeaturePluginsLoading: int32                â”‚  â”‚
â”‚  â”‚ + SetCurrentExperience(FPrimaryAssetId)              â”‚  â”‚
â”‚  â”‚ + CallOrRegister_OnExperienceLoaded()                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼             â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Game Feature 1   â”‚  â”‚ GameFeatureAction   â”‚
               â”‚ (Plugin)         â”‚  â”‚ (Instanced Objects) â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ç±»èŒè´£

#### 1. ULyraExperienceDefinition

**ä½ç½®**ï¼š`LyraGame/GameModes/LyraExperienceDefinition.h`

è¿™æ˜¯ Experience çš„æ ¸å¿ƒæ•°æ®èµ„äº§ï¼Œç»§æ‰¿è‡ª `UPrimaryDataAsset`ã€‚å®ƒå®šä¹‰äº†ï¼š

```cpp
UCLASS(BlueprintType, Const)
class ULyraExperienceDefinition : public UPrimaryDataAsset
{
    GENERATED_BODY()

public:
    // éœ€è¦æ¿€æ´»çš„ Game Feature æ’ä»¶åˆ—è¡¨
    UPROPERTY(EditDefaultsOnly, Category = Gameplay)
    TArray<FString> GameFeaturesToEnable;

    // é»˜è®¤çš„ Pawn æ•°æ®ï¼ˆè§’è‰²ç±»ã€è¾“å…¥é…ç½®ç­‰ï¼‰
    UPROPERTY(EditDefaultsOnly, Category=Gameplay)
    TObjectPtr<const ULyraPawnData> DefaultPawnData;

    // éœ€è¦æ‰§è¡Œçš„ Action åˆ—è¡¨ï¼ˆç›´æ¥é…ç½®ï¼‰
    UPROPERTY(EditDefaultsOnly, Instanced, Category="Actions")
    TArray<TObjectPtr<UGameFeatureAction>> Actions;

    // é¢å¤–çš„ Action Setï¼ˆç»„åˆå¤šä¸ª Actionï¼‰
    UPROPERTY(EditDefaultsOnly, Category=Gameplay)
    TArray<TObjectPtr<ULyraExperienceActionSet>> ActionSets;
};
```

**è®¾è®¡äº®ç‚¹ï¼š**
- `GameFeaturesToEnable`ï¼šå£°æ˜å¼ä¾èµ–ç®¡ç†ï¼Œè‡ªåŠ¨åŠ è½½æ‰€éœ€æ’ä»¶
- `Actions` å’Œ `ActionSets`ï¼šçµæ´»çš„ç»„åˆæœºåˆ¶ï¼Œæ”¯æŒ Action å¤ç”¨
- `Const` é™å®šç¬¦ï¼šè¿è¡Œæ—¶ä¸å¯ä¿®æ”¹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

#### 2. ULyraExperienceManagerComponent

**ä½ç½®**ï¼š`LyraGame/GameModes/LyraExperienceManagerComponent.h`

è¿™æ˜¯æŒ‚è½½åœ¨ `GameState` ä¸Šçš„ç»„ä»¶ï¼Œè´Ÿè´£ Experience çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```cpp
UCLASS()
class ULyraExperienceManagerComponent : public UGameStateComponent
{
    GENERATED_BODY()

public:
    // è®¾ç½®å¹¶åŠ è½½ Experience
    void SetCurrentExperience(FPrimaryAssetId ExperienceId);

    // æ³¨å†Œå›è°ƒï¼ŒExperience åŠ è½½å®Œæˆåæ‰§è¡Œ
    void CallOrRegister_OnExperienceLoaded(FOnLyraExperienceLoaded::FDelegate&& Delegate);
    
    // è·å–å½“å‰å·²åŠ è½½çš„ Experienceï¼ˆå¿…é¡»å·²å®ŒæˆåŠ è½½ï¼‰
    const ULyraExperienceDefinition* GetCurrentExperienceChecked() const;
    
    // æ£€æŸ¥ Experience æ˜¯å¦å·²åŠ è½½å®Œæˆ
    bool IsExperienceLoaded() const;

private:
    // å½“å‰çš„ Experienceï¼ˆç½‘ç»œåŒæ­¥ï¼‰
    UPROPERTY(ReplicatedUsing=OnRep_CurrentExperience)
    TObjectPtr<const ULyraExperienceDefinition> CurrentExperience;

    // åŠ è½½çŠ¶æ€æœº
    ELyraExperienceLoadState LoadState = ELyraExperienceLoadState::Unloaded;

    // åŠ è½½å®Œæˆå›è°ƒï¼ˆæ”¯æŒä¸‰ä¸ªä¼˜å…ˆçº§ï¼‰
    FOnLyraExperienceLoaded OnExperienceLoaded_HighPriority;
    FOnLyraExperienceLoaded OnExperienceLoaded;
    FOnLyraExperienceLoaded OnExperienceLoaded_LowPriority;
};
```

**è®¾è®¡äº®ç‚¹ï¼š**
- **ç½‘ç»œåŒæ­¥**ï¼š`CurrentExperience` ä¼šè‡ªåŠ¨ä»æœåŠ¡å™¨åŒæ­¥åˆ°å®¢æˆ·ç«¯
- **ä¼˜å…ˆçº§å›è°ƒ**ï¼šä¸‰çº§å›è°ƒç³»ç»Ÿï¼Œç¡®ä¿åˆå§‹åŒ–é¡ºåºå¯æ§
- **çŠ¶æ€æœºç®¡ç†**ï¼šæ¸…æ™°çš„åŠ è½½é˜¶æ®µåˆ’åˆ†ï¼ˆåæ–‡è¯¦è§£ï¼‰

#### 3. ULyraExperienceActionSet

**ä½ç½®**ï¼š`LyraGame/GameModes/LyraExperienceActionSet.h`

Action Set æ˜¯å¤šä¸ª GameFeatureAction çš„é›†åˆï¼Œç”¨äºç»„ç»‡å’Œå¤ç”¨ï¼š

```cpp
UCLASS(BlueprintType, NotBlueprintable)
class ULyraExperienceActionSet : public UPrimaryDataAsset
{
    GENERATED_BODY()

public:
    // Action åˆ—è¡¨
    UPROPERTY(EditAnywhere, Instanced, Category="Actions to Perform")
    TArray<TObjectPtr<UGameFeatureAction>> Actions;

    // ä¾èµ–çš„ Game Feature æ’ä»¶
    UPROPERTY(EditAnywhere, Category="Feature Dependencies")
    TArray<FString> GameFeaturesToEnable;
};
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- å¤ç”¨é€šç”¨ Action ç»„åˆï¼ˆå¦‚"åŸºç¡€è¾“å…¥+UI"ï¼‰
- åˆ†å±‚ç»„ç»‡ Experienceï¼ˆæ ¸å¿ƒ + å˜ä½“ï¼‰
- ç®€åŒ– Experience Definition çš„é…ç½®

---

## ğŸ”„ Experience åŠ è½½æµç¨‹è¯¦è§£

### åŠ è½½çŠ¶æ€æœº

Experience çš„åŠ è½½æ˜¯ä¸€ä¸ªå¤æ‚çš„å¼‚æ­¥è¿‡ç¨‹ï¼ŒLyra ä½¿ç”¨çŠ¶æ€æœºæ¥ç®¡ç†ï¼š

```cpp
enum class ELyraExperienceLoadState
{
    Unloaded,                    // æœªåŠ è½½
    Loading,                     // åŠ è½½ Experience æœ¬èº«çš„èµ„äº§
    LoadingGameFeatures,         // åŠ è½½ Game Feature æ’ä»¶
    LoadingChaosTestingDelay,    // ï¼ˆå¯é€‰ï¼‰å»¶è¿ŸåŠ è½½ï¼Œç”¨äºæ··æ²Œæµ‹è¯•
    ExecutingActions,            // æ‰§è¡Œ GameFeatureAction
    Loaded,                      // åŠ è½½å®Œæˆ
    Deactivating                 // æ­£åœ¨å¸è½½
};
```

### å®Œæ•´åŠ è½½æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant GM as GameMode
    participant EMC as ExperienceManagerComponent
    participant AM as AssetManager
    participant GFS as GameFeaturesSubsystem
    participant Action as GameFeatureAction

    GM->>EMC: SetCurrentExperience(ExperienceId)
    EMC->>AM: LoadPrimaryAsset(ExperienceId)
    AM-->>EMC: Experience Asset Loaded
    
    Note over EMC: State = Loading
    
    EMC->>AM: LoadAssetBundle(Experience + ActionSets)
    AM-->>EMC: Bundles Loaded
    
    Note over EMC: State = LoadingGameFeatures
    
    loop For each GameFeature
        EMC->>GFS: LoadAndActivateGameFeaturePlugin(PluginURL)
        GFS-->>EMC: OnPluginLoaded Callback
    end
    
    Note over EMC: State = ExecutingActions
    
    loop For each GameFeatureAction
        EMC->>Action: OnGameFeatureActivating()
        Action->>Action: AddToWorld() / GrantAbilities() / AddWidgets()
        Action-->>EMC: Action Complete
    end
    
    Note over EMC: State = Loaded
    
    EMC->>EMC: Broadcast OnExperienceLoaded
    EMC->>GM: Experience Ready
```

### å…³é”®ä»£ç è§£æ

#### 1. å¯åŠ¨åŠ è½½

```cpp
void ULyraExperienceManagerComponent::SetCurrentExperience(FPrimaryAssetId ExperienceId)
{
    // 1. åŠ è½½ Experience èµ„äº§æœ¬èº«
    ULyraAssetManager& AssetManager = ULyraAssetManager::Get();
    FSoftObjectPath AssetPath = AssetManager.GetPrimaryAssetPath(ExperienceId);
    TSubclassOf<ULyraExperienceDefinition> AssetClass = Cast<UClass>(AssetPath.TryLoad());
    
    check(AssetClass);
    const ULyraExperienceDefinition* Experience = GetDefault<ULyraExperienceDefinition>(AssetClass);
    
    check(Experience != nullptr);
    check(CurrentExperience == nullptr); // ç¡®ä¿ä¸ä¼šé‡å¤åŠ è½½
    
    CurrentExperience = Experience;
    StartExperienceLoad();
}
```

#### 2. åŠ è½½ä¾èµ–èµ„äº§

```cpp
void ULyraExperienceManagerComponent::StartExperienceLoad()
{
    check(CurrentExperience != nullptr);
    check(LoadState == ELyraExperienceLoadState::Unloaded);

    LoadState = ELyraExperienceLoadState::Loading;

    ULyraAssetManager& AssetManager = ULyraAssetManager::Get();

    // æ”¶é›†æ‰€æœ‰éœ€è¦åŠ è½½çš„èµ„äº§
    TSet<FPrimaryAssetId> BundleAssetList;
    BundleAssetList.Add(CurrentExperience->GetPrimaryAssetId());
    
    // æ·»åŠ  ActionSet çš„èµ„äº§
    for (const TObjectPtr<ULyraExperienceActionSet>& ActionSet : CurrentExperience->ActionSets)
    {
        if (ActionSet != nullptr)
        {
            BundleAssetList.Add(ActionSet->GetPrimaryAssetId());
        }
    }

    // å¼‚æ­¥åŠ è½½èµ„äº§åŒ…
    TArray<FName> BundlesToLoad;
    BundlesToLoad.Add(UGameFeaturesSubsystemSettings::LoadStateClient);
    BundlesToLoad.Add(UGameFeaturesSubsystemSettings::LoadStateServer);

    AssetManager.LoadPrimaryAssets(
        BundleAssetList.Array(),
        BundlesToLoad,
        FStreamableDelegate::CreateUObject(this, &ThisClass::OnExperienceLoadComplete)
    );
}
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `AssetManager` çš„ Bundle ç³»ç»Ÿï¼ŒæŒ‰éœ€åŠ è½½èµ„äº§
- åŒºåˆ† Client å’Œ Server Bundleï¼Œä¼˜åŒ–å†…å­˜å ç”¨
- å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹

#### 3. åŠ è½½ Game Feature æ’ä»¶

```cpp
void ULyraExperienceManagerComponent::OnExperienceLoadComplete()
{
    check(LoadState == ELyraExperienceLoadState::Loading);
    LoadState = ELyraExperienceLoadState::LoadingGameFeatures;

    // æ”¶é›†æ‰€æœ‰éœ€è¦åŠ è½½çš„æ’ä»¶ URL
    GameFeaturePluginURLs.Reset();
    
    auto CollectGameFeaturePluginURLs = [this](const UPrimaryDataAsset* Context, const TArray<FString>& FeaturePluginList)
    {
        for (const FString& PluginName : FeaturePluginList)
        {
            FString PluginURL;
            if (UGameFeaturesSubsystem::Get().GetPluginURLByName(PluginName, PluginURL))
            {
                GameFeaturePluginURLs.AddUnique(PluginURL);
            }
        }
    };

    // ä» Experience å’Œ ActionSet æ”¶é›†æ’ä»¶åˆ—è¡¨
    CollectGameFeaturePluginURLs(CurrentExperience, CurrentExperience->GameFeaturesToEnable);
    for (const ULyraExperienceActionSet* ActionSet : CurrentExperience->ActionSets)
    {
        if (ActionSet != nullptr)
        {
            CollectGameFeaturePluginURLs(ActionSet, ActionSet->GameFeaturesToEnable);
        }
    }

    // å¼€å§‹åŠ è½½æ’ä»¶
    NumGameFeaturePluginsLoading = GameFeaturePluginURLs.Num();
    if (NumGameFeaturePluginsLoading > 0)
    {
        for (const FString& PluginURL : GameFeaturePluginURLs)
        {
            UGameFeaturesSubsystem::Get().LoadAndActivateGameFeaturePlugin(
                PluginURL, 
                FGameFeaturePluginLoadComplete::CreateUObject(this, &ThisClass::OnGameFeaturePluginLoadComplete)
            );
        }
    }
    else
    {
        OnExperienceFullLoadCompleted();
    }
}
```

**è®¾è®¡äº®ç‚¹ï¼š**
- è‡ªåŠ¨å»é‡æ’ä»¶ URL
- æ”¯æŒå¹¶è¡ŒåŠ è½½å¤šä¸ªæ’ä»¶
- ä½¿ç”¨è®¡æ•°å™¨è¿½è¸ªåŠ è½½è¿›åº¦

#### 4. æ‰§è¡Œ GameFeatureAction

```cpp
void ULyraExperienceManagerComponent::OnExperienceFullLoadCompleted()
{
    check(LoadState != ELyraExperienceLoadState::Loaded);

    LoadState = ELyraExperienceLoadState::ExecutingActions;

    // æ”¶é›†æ‰€æœ‰ Actionï¼ˆåŒ…æ‹¬ ActionSet ä¸­çš„ï¼‰
    FGameFeatureActivatingContext Context;
    const FWorldContext* ExistingWorldContext = GEngine->GetWorldContextFromWorld(GetWorld());
    if (ExistingWorldContext)
    {
        Context.SetRequiredWorldContextHandle(ExistingWorldContext->ContextHandle);
    }

    auto ActivateListOfActions = [&Context](const TArray<UGameFeatureAction*>& ActionList)
    {
        for (UGameFeatureAction* Action : ActionList)
        {
            if (Action != nullptr)
            {
                Action->OnGameFeatureActivating(Context);
            }
        }
    };

    // æ¿€æ´» Experience çš„ Action
    ActivateListOfActions(CurrentExperience->Actions);

    // æ¿€æ´» ActionSet çš„ Action
    for (const ULyraExperienceActionSet* ActionSet : CurrentExperience->ActionSets)
    {
        if (ActionSet != nullptr)
        {
            ActivateListOfActions(ActionSet->Actions);
        }
    }

    LoadState = ELyraExperienceLoadState::Loaded;

    // è§¦å‘åŠ è½½å®Œæˆå›è°ƒï¼ˆæŒ‰ä¼˜å…ˆçº§é¡ºåºï¼‰
    OnExperienceLoaded_HighPriority.Broadcast(CurrentExperience);
    OnExperienceLoaded_HighPriority.Clear();

    OnExperienceLoaded.Broadcast(CurrentExperience);
    OnExperienceLoaded.Clear();

    OnExperienceLoaded_LowPriority.Broadcast(CurrentExperience);
    OnExperienceLoaded_LowPriority.Clear();
}
```

**ä¸‰çº§å›è°ƒçš„åº”ç”¨åœºæ™¯ï¼š**
- **HighPriority**ï¼šåˆå§‹åŒ–åº•å±‚ç³»ç»Ÿï¼ˆå¦‚ AbilitySystemComponentï¼‰
- **Normal**ï¼šæ³¨å†Œæ¸¸æˆé€»è¾‘ï¼ˆå¦‚ GamePhaseã€TeamSubsystemï¼‰
- **LowPriority**ï¼šåˆå§‹åŒ– UI å’Œè¡¨ç°å±‚

---

## âš™ï¸ GameFeatureAction æ·±åº¦è§£æ

### ä»€ä¹ˆæ˜¯ GameFeatureActionï¼Ÿ

`GameFeatureAction` æ˜¯ UE5 Game Features æ’ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒå®šä¹‰äº†**æ’ä»¶æ¿€æ´»æ—¶è¦æ‰§è¡Œçš„æ“ä½œ**ã€‚

Lyra æ‰©å±•äº†å¤šç§ Action ç±»å‹ï¼š

| Action ç±» | åŠŸèƒ½è¯´æ˜ |
|-----------|----------|
| `GameFeatureAction_AddAbilities` | ä¸ºæŒ‡å®š Actor æ·»åŠ  Gameplay Ability |
| `GameFeatureAction_AddInputBinding` | ç»‘å®šè¾“å…¥åŠ¨ä½œåˆ° Ability |
| `GameFeatureAction_AddWidget` | åŠ¨æ€æ·»åŠ  UI Widget åˆ° HUD |
| `GameFeatureAction_AddInputContextMapping` | æ·»åŠ  Enhanced Input æ˜ å°„ |
| `GameFeatureAction_SplitscreenConfig` | é…ç½®åˆ†å±è®¾ç½® |

### æ¡ˆä¾‹ï¼šAddAbilities Action

è¿™æ˜¯æœ€å¸¸ç”¨çš„ Actionï¼Œç”¨äºä¸º Character æ·»åŠ æŠ€èƒ½ã€‚

#### é…ç½®ç»“æ„

```cpp
UCLASS(MinimalAPI, meta = (DisplayName = "Add Abilities"))
class UGameFeatureAction_AddAbilities final : public UGameFeatureAction_WorldActionBase
{
    GENERATED_BODY()

public:
    // é…ç½®åˆ—è¡¨ï¼šä¸ºå“ªäº› Actor æ·»åŠ å“ªäº›èƒ½åŠ›
    UPROPERTY(EditAnywhere, Category="Abilities")
    TArray<FGameFeatureAbilitiesEntry> AbilitiesList;
};

USTRUCT()
struct FGameFeatureAbilitiesEntry
{
    GENERATED_BODY()

    // ç›®æ ‡ Actor ç±»ï¼ˆå¦‚ ALyraCharacterï¼‰
    UPROPERTY(EditAnywhere, Category="Abilities")
    TSoftClassPtr<AActor> ActorClass;

    // è¦æˆäºˆçš„ Ability åˆ—è¡¨
    UPROPERTY(EditAnywhere, Category="Abilities")
    TArray<FLyraAbilityGrant> GrantedAbilities;

    // è¦æ·»åŠ çš„ Attribute Set
    UPROPERTY(EditAnywhere, Category="Attributes")
    TArray<FLyraAttributeSetGrant> GrantedAttributes;

    // è¦æˆäºˆçš„ Ability Setï¼ˆæ‰¹é‡æ·»åŠ ï¼‰
    UPROPERTY(EditAnywhere, Category="Attributes")
    TArray<TSoftObjectPtr<const ULyraAbilitySet>> GrantedAbilitySets;
};
```

#### æ‰§è¡Œæµç¨‹

```cpp
void UGameFeatureAction_AddAbilities::AddToWorld(const FWorldContext& WorldContext, const FGameFeatureStateChangeContext& ChangeContext)
{
    UWorld* World = WorldContext.World();
    UGameInstance* GameInstance = WorldContext.OwningGameInstance;
    FPerContextData& ActiveData = ContextData.FindOrAdd(ChangeContext);

    // ä¸ºæ¯ä¸ªé…ç½®é¡¹æ³¨å†Œ Actor æ‰©å±•
    for (int32 EntryIdx = 0; EntryIdx < AbilitiesList.Num(); ++EntryIdx)
    {
        const FGameFeatureAbilitiesEntry& Entry = AbilitiesList[EntryIdx];

        if (!Entry.ActorClass.IsNull())
        {
            // ä½¿ç”¨ ModularGameplayActors æ’ä»¶çš„æ‰©å±•ç³»ç»Ÿ
            // å½“ç›®æ ‡ Actor ç”Ÿæˆæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œå›è°ƒ
            UGameFrameworkComponentManager* ComponentMan = UGameInstance->GetSubsystem<UGameFrameworkComponentManager>();
            
            TSharedPtr<FComponentRequestHandle> ExtensionRequestHandle = ComponentMan->AddExtensionHandler(
                Entry.ActorClass,
                UGameFrameworkComponentManager::FExtensionHandlerDelegate::CreateUObject(
                    this, 
                    &ThisClass::HandleActorExtension, 
                    EntryIdx, 
                    ChangeContext
                )
            );

            ActiveData.ComponentRequests.Add(ExtensionRequestHandle);
        }
    }
}

void UGameFeatureAction_AddAbilities::HandleActorExtension(AActor* Actor, FName EventName, int32 EntryIndex, FGameFeatureStateChangeContext ChangeContext)
{
    FPerContextData& ActiveData = ContextData.FindChecked(ChangeContext);
    const FGameFeatureAbilitiesEntry& Entry = AbilitiesList[EntryIndex];

    if (EventName == UGameFrameworkComponentManager::NAME_ExtensionAdded || 
        EventName == UGameFrameworkComponentManager::NAME_GameActorReady)
    {
        AddActorAbilities(Actor, Entry, ActiveData);
    }
    else if (EventName == UGameFrameworkComponentManager::NAME_ExtensionRemoved || 
             EventName == UGameFrameworkComponentManager::NAME_ReceiverRemoved)
    {
        RemoveActorAbilities(Actor, ActiveData);
    }
}

void UGameFeatureAction_AddAbilities::AddActorAbilities(AActor* Actor, const FGameFeatureAbilitiesEntry& Entry, FPerContextData& ActiveData)
{
    // ç¡®ä¿ Actor æœ‰ AbilitySystemComponent
    UAbilitySystemComponent* ASC = FindOrAddComponentForActor<UAbilitySystemComponent>(Actor, Entry, ActiveData);
    if (!ASC)
    {
        return;
    }

    FActorExtensions& ActorExtensions = ActiveData.ActiveExtensions.FindOrAdd(Actor);

    // æ·»åŠ  Abilities
    for (const FLyraAbilityGrant& AbilityGrant : Entry.GrantedAbilities)
    {
        if (!AbilityGrant.AbilityType.IsNull())
        {
            TSubclassOf<UGameplayAbility> AbilityClass = AbilityGrant.AbilityType.LoadSynchronous();
            if (AbilityClass)
            {
                FGameplayAbilitySpec AbilitySpec(AbilityClass);
                FGameplayAbilitySpecHandle AbilityHandle = ASC->GiveAbility(AbilitySpec);
                ActorExtensions.Abilities.Add(AbilityHandle);
            }
        }
    }

    // æ·»åŠ  Attribute Sets
    for (const FLyraAttributeSetGrant& AttributeGrant : Entry.GrantedAttributes)
    {
        if (!AttributeGrant.AttributeSetType.IsNull())
        {
            TSubclassOf<UAttributeSet> SetClass = AttributeGrant.AttributeSetType.LoadSynchronous();
            if (SetClass)
            {
                UAttributeSet* NewSet = NewObject<UAttributeSet>(ASC->GetOwner(), SetClass);
                ASC->AddAttributeSetSubobject(NewSet);
                ActorExtensions.Attributes.Add(NewSet);

                // å¦‚æœæœ‰åˆå§‹åŒ–æ•°æ®è¡¨ï¼Œåº”ç”¨åˆå§‹å€¼
                if (!AttributeGrant.InitializationData.IsNull())
                {
                    UDataTable* InitTable = AttributeGrant.InitializationData.LoadSynchronous();
                    if (InitTable)
                    {
                        NewSet->InitFromMetaDataTable(InitTable);
                    }
                }
            }
        }
    }

    // æ·»åŠ  Ability Setsï¼ˆæ‰¹é‡æˆäºˆï¼‰
    for (const TSoftObjectPtr<const ULyraAbilitySet>& SetPtr : Entry.GrantedAbilitySets)
    {
        if (!SetPtr.IsNull())
        {
            const ULyraAbilitySet* AbilitySet = SetPtr.LoadSynchronous();
            if (AbilitySet)
            {
                FLyraAbilitySet_GrantedHandles GrantedHandles;
                AbilitySet->GiveToAbilitySystem(ASC, &GrantedHandles);
                ActorExtensions.AbilitySetHandles.Add(GrantedHandles);
            }
        }
    }
}
```

**è®¾è®¡äº®ç‚¹ï¼š**
1. **å»¶è¿Ÿç»‘å®š**ï¼šä¸æ˜¯åœ¨ Action æ¿€æ´»æ—¶ç«‹å³æ·»åŠ  Abilityï¼Œè€Œæ˜¯ç›‘å¬ Actor çš„ç”Ÿæˆäº‹ä»¶
2. **è‡ªåŠ¨æ¸…ç†**ï¼šActor é”€æ¯æ—¶è‡ªåŠ¨ç§»é™¤æ·»åŠ çš„ Ability å’Œ Attribute
3. **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒ AbilitySetï¼Œä¸€æ¬¡æ€§æˆäºˆå¤šä¸ªèƒ½åŠ›
4. **æ•°æ®è¡¨åˆå§‹åŒ–**ï¼šæ”¯æŒä» DataTable åˆå§‹åŒ– Attribute çš„é»˜è®¤å€¼

---

## ğŸ› ï¸ å®æˆ˜ï¼šåˆ›å»ºè‡ªå®šä¹‰ Experience

### éœ€æ±‚åˆ†æ

æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª **"å¤ºæ——æ¨¡å¼"ï¼ˆCapture The Flagï¼‰** çš„ Experienceï¼ŒåŒ…å«ï¼š

1. **åŸºç¡€ç©æ³•**ï¼šä¸¤é˜Ÿå„æœ‰ä¸€ä¸ªåŸºåœ°å’Œæ——å¸œ
2. **æ¸¸æˆè§„åˆ™**ï¼šå¤ºå–å¯¹æ–¹æ——å¸œå¹¶å¸¦å›å·±æ–¹åŸºåœ°å¾—åˆ†
3. **è§’è‰²èƒ½åŠ›**ï¼šç§»åŠ¨ã€è·³è·ƒã€å°„å‡»ã€æºå¸¦æ——å¸œ
4. **UI æ˜¾ç¤º**ï¼šé˜Ÿä¼å¾—åˆ†ã€æ——å¸œçŠ¶æ€

### æ­¥éª¤ 1ï¼šåˆ›å»º Experience Definition

**æ–‡ä»¶**ï¼š`Content/Experiences/CTF/B_CTFExperience.uasset`

åœ¨ç¼–è¾‘å™¨ä¸­ï¼š
1. å³é”® â†’ `Game` â†’ `Lyra Experience Definition`
2. å‘½åä¸º `B_CTFExperience`
3. é…ç½®å±æ€§ï¼š

```
Experience Definition: B_CTFExperience
â”œâ”€ Game Features To Enable:
â”‚   â””â”€ "CTFGameMode"               // æˆ‘ä»¬çš„è‡ªå®šä¹‰æ’ä»¶
â”œâ”€ Default Pawn Data:
â”‚   â””â”€ DA_CTFPlayerPawn            // CTF è§’è‰²æ•°æ®
â”œâ”€ Actions:
â”‚   â”œâ”€ Add Abilities
â”‚   â”‚   â””â”€ Actor Class: LyraCharacter
â”‚   â”‚       â”œâ”€ Granted Abilities:
â”‚   â”‚       â”‚   â”œâ”€ GA_Move        // ç§»åŠ¨èƒ½åŠ›
â”‚   â”‚       â”‚   â”œâ”€ GA_Jump        // è·³è·ƒèƒ½åŠ›
â”‚   â”‚       â”‚   â””â”€ GA_PickupFlag  // æ‹¾å–æ——å¸œèƒ½åŠ›
â”‚   â”‚       â””â”€ Granted Ability Sets:
â”‚   â”‚           â””â”€ AbilitySet_ShooterHero  // å°„å‡»èƒ½åŠ›é›†
â”‚   â””â”€ Add Input Context Mapping
â”‚       â””â”€ Input Mapping: IMC_CTF  // CTF è¾“å…¥é…ç½®
â””â”€ Action Sets:
    â””â”€ AS_SharedUI                 // å…±äº« UI é…ç½®
```

### æ­¥éª¤ 2ï¼šåˆ›å»º Game Feature æ’ä»¶

ä½¿ç”¨ UE ç¼–è¾‘å™¨åˆ›å»ºæ’ä»¶ï¼š

**æ–‡ä»¶ç»“æ„ï¼š**
```
Plugins/GameFeatures/CTFGameMode/
â”œâ”€ CTFGameMode.uplugin
â”œâ”€ Content/
â”‚   â”œâ”€ GameMode/
â”‚   â”‚   â””â”€ B_CTFGameMode.uasset
â”‚   â”œâ”€ Actors/
â”‚   â”‚   â”œâ”€ BP_FlagBase.uasset
â”‚   â”‚   â””â”€ BP_Flag.uasset
â”‚   â””â”€ UI/
â”‚       â””â”€ W_CTFScoreboard.uasset
â””â”€ Source/
    â””â”€ CTFGameModeRuntime/
        â”œâ”€ Private/
        â”‚   â”œâ”€ CTFGameState.cpp
        â”‚   â”œâ”€ CTFFlagComponent.cpp
        â”‚   â””â”€ CTFScoringSubsystem.cpp
        â””â”€ Public/
            â”œâ”€ CTFGameState.h
            â”œâ”€ CTFFlagComponent.h
            â””â”€ CTFScoringSubsystem.h
```

**æ’ä»¶æè¿°æ–‡ä»¶**ï¼š`CTFGameMode.uplugin`

```json
{
    "FileVersion": 3,
    "Version": 1,
    "VersionName": "1.0",
    "FriendlyName": "CTF Game Mode",
    "Description": "Capture The Flag game mode for Lyra",
    "Category": "Game Features",
    "CreatedBy": "Your Team",
    "BuiltInInitialFeatureState": "Active",
    "Plugins": [
        {
            "Name": "GameFeatures",
            "Enabled": true
        },
        {
            "Name": "ModularGameplayActors",
            "Enabled": true
        }
    ]
}
```

### æ­¥éª¤ 3ï¼šå®ç° CTF Game State

**æ–‡ä»¶**ï¼š`CTFGameState.h`

```cpp
#pragma once

#include "ModularGameState.h"
#include "CTFGameState.generated.h"

// é˜Ÿä¼å¾—åˆ†ç»“æ„
USTRUCT(BlueprintType)
struct FTeamScore
{
    GENERATED_BODY()

    UPROPERTY(BlueprintReadOnly)
    int32 TeamId = 0;

    UPROPERTY(BlueprintReadOnly)
    int32 Score = 0;

    UPROPERTY(BlueprintReadOnly)
    int32 FlagCaptures = 0;
};

/**
 * CTF æ¨¡å¼çš„ GameStateï¼Œç®¡ç†é˜Ÿä¼å¾—åˆ†å’Œæ——å¸œçŠ¶æ€
 */
UCLASS()
class ACTFGameState : public AModularGameStateBase
{
    GENERATED_BODY()

public:
    ACTFGameState();

    //~ Begin AActor Interface
    virtual void GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const override;
    //~ End AActor Interface

    // å¢åŠ é˜Ÿä¼å¾—åˆ†
    UFUNCTION(BlueprintCallable, Category="CTF")
    void AddTeamScore(int32 TeamId, int32 Points);

    // è·å–é˜Ÿä¼å¾—åˆ†
    UFUNCTION(BlueprintPure, Category="CTF")
    int32 GetTeamScore(int32 TeamId) const;

    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°èƒœåˆ©æ¡ä»¶
    UFUNCTION(BlueprintPure, Category="CTF")
    bool HasTeamWon(int32& OutWinningTeam) const;

protected:
    // é˜Ÿä¼å¾—åˆ†æ•°ç»„ï¼ˆç½‘ç»œåŒæ­¥ï¼‰
    UPROPERTY(ReplicatedUsing=OnRep_TeamScores, BlueprintReadOnly)
    TArray<FTeamScore> TeamScores;

    // è·èƒœæ‰€éœ€åˆ†æ•°
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category="CTF")
    int32 ScoreToWin = 3;

private:
    UFUNCTION()
    void OnRep_TeamScores();

    // åˆå§‹åŒ–é˜Ÿä¼å¾—åˆ†
    void InitializeTeamScores();
};
```

**æ–‡ä»¶**ï¼š`CTFGameState.cpp`

```cpp
#include "CTFGameState.h"
#include "Net/UnrealNetwork.h"
#include "Teams/LyraTeamSubsystem.h"

ACTFGameState::ACTFGameState()
{
    // ç¡®ä¿å¾—åˆ†åœ¨ç½‘ç»œä¸ŠåŒæ­¥
    bReplicates = true;
    bAlwaysRelevant = true;
}

void ACTFGameState::GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const
{
    Super::GetLifetimeReplicatedProps(OutLifetimeProps);

    DOREPLIFETIME(ACTFGameState, TeamScores);
}

void ACTFGameState::InitializeTeamScores()
{
    // ä» Team Subsystem è·å–é˜Ÿä¼æ•°é‡
    ULyraTeamSubsystem* TeamSubsystem = GetWorld()->GetSubsystem<ULyraTeamSubsystem>();
    if (TeamSubsystem)
    {
        TArray<int32> TeamIds = TeamSubsystem->GetAllTeamIds();
        for (int32 TeamId : TeamIds)
        {
            FTeamScore NewScore;
            NewScore.TeamId = TeamId;
            NewScore.Score = 0;
            NewScore.FlagCaptures = 0;
            TeamScores.Add(NewScore);
        }
    }
}

void ACTFGameState::AddTeamScore(int32 TeamId, int32 Points)
{
    if (!HasAuthority())
    {
        return; // åªèƒ½åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹å¾—åˆ†
    }

    for (FTeamScore& Score : TeamScores)
    {
        if (Score.TeamId == TeamId)
        {
            Score.Score += Points;
            Score.FlagCaptures++;
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            if (Score.Score >= ScoreToWin)
            {
                // è§¦å‘æ¸¸æˆç»“æŸé€»è¾‘ï¼ˆåœ¨å®é™…é¡¹ç›®ä¸­åº”é€šè¿‡ GamePhase å¤„ç†ï¼‰
                UE_LOG(LogTemp, Log, TEXT("Team %d wins with %d points!"), TeamId, Score.Score);
            }
            break;
        }
    }
}

int32 ACTFGameState::GetTeamScore(int32 TeamId) const
{
    for (const FTeamScore& Score : TeamScores)
    {
        if (Score.TeamId == TeamId)
        {
            return Score.Score;
        }
    }
    return 0;
}

bool ACTFGameState::HasTeamWon(int32& OutWinningTeam) const
{
    for (const FTeamScore& Score : TeamScores)
    {
        if (Score.Score >= ScoreToWin)
        {
            OutWinningTeam = Score.TeamId;
            return true;
        }
    }
    return false;
}

void ACTFGameState::OnRep_TeamScores()
{
    // å½“å¾—åˆ†å˜åŒ–æ—¶ï¼Œé€šçŸ¥ UI æ›´æ–°
    // å¯ä»¥åœ¨è¿™é‡Œè§¦å‘ UI åˆ·æ–°äº‹ä»¶
}
```

### æ­¥éª¤ 4ï¼šå®ç°æ——å¸œç»„ä»¶

**æ–‡ä»¶**ï¼š`CTFFlagComponent.h`

```cpp
#pragma once

#include "Components/ActorComponent.h"
#include "GameplayTagContainer.h"
#include "CTFFlagComponent.generated.h"

// æ——å¸œçŠ¶æ€æšä¸¾
UENUM(BlueprintType)
enum class EFlagState : uint8
{
    AtBase,         // åœ¨åŸºåœ°
    Carried,        // è¢«æºå¸¦
    Dropped         // æ‰è½åœ¨åœ°
};

/**
 * æ——å¸œç»„ä»¶ï¼Œç®¡ç†æ——å¸œçš„çŠ¶æ€å’Œé€»è¾‘
 */
UCLASS(BlueprintType, meta=(BlueprintSpawnableComponent))
class UCTFFlagComponent : public UActorComponent
{
    GENERATED_BODY()

public:
    UCTFFlagComponent();

    //~ Begin UActorComponent Interface
    virtual void GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const override;
    //~ End UActorComponent Interface

    // æ‹¾å–æ——å¸œ
    UFUNCTION(BlueprintCallable, Category="CTF")
    bool PickupFlag(AActor* NewCarrier);

    // æ”¾ä¸‹æ——å¸œ
    UFUNCTION(BlueprintCallable, Category="CTF")
    void DropFlag();

    // å½’è¿˜æ——å¸œåˆ°åŸºåœ°
    UFUNCTION(BlueprintCallable, Category="CTF")
    void ReturnToBase();

    // å°è¯•å¾—åˆ†ï¼ˆæºå¸¦æ——å¸œåˆ°å·±æ–¹åŸºåœ°ï¼‰
    UFUNCTION(BlueprintCallable, Category="CTF")
    bool AttemptScore(AActor* ScoringActor);

    // è·å–å½“å‰çŠ¶æ€
    UFUNCTION(BlueprintPure, Category="CTF")
    EFlagState GetFlagState() const { return FlagState; }

    // è·å–æ‰€å±é˜Ÿä¼
    UFUNCTION(BlueprintPure, Category="CTF")
    int32 GetTeamId() const { return TeamId; }

protected:
    // æ——å¸œçŠ¶æ€ï¼ˆç½‘ç»œåŒæ­¥ï¼‰
    UPROPERTY(ReplicatedUsing=OnRep_FlagState, BlueprintReadOnly)
    EFlagState FlagState = EFlagState::AtBase;

    // å½“å‰æºå¸¦è€…
    UPROPERTY(ReplicatedUsing=OnRep_Carrier, BlueprintReadOnly)
    TObjectPtr<AActor> Carrier;

    // åŸºåœ°ä½ç½®
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category="CTF")
    FVector BaseLocation;

    // æ‰€å±é˜Ÿä¼ ID
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category="CTF")
    int32 TeamId = 0;

    // æ‰è½åè‡ªåŠ¨å½’è¿˜æ—¶é—´ï¼ˆç§’ï¼‰
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category="CTF")
    float AutoReturnTime = 30.0f;

private:
    UFUNCTION()
    void OnRep_FlagState();

    UFUNCTION()
    void OnRep_Carrier();

    // æ‰è½è®¡æ—¶å™¨
    FTimerHandle DropTimerHandle;

    // å¤„ç†æ‰è½è¶…æ—¶
    void OnDropTimeout();
};
```

**å…³é”®å®ç°**ï¼š

```cpp
bool UCTFFlagComponent::PickupFlag(AActor* NewCarrier)
{
    if (!GetOwner()->HasAuthority())
    {
        return false; // åªèƒ½åœ¨æœåŠ¡å™¨ä¸Šæ‹¾å–
    }

    if (FlagState == EFlagState::Carried)
    {
        return false; // å·²è¢«æºå¸¦
    }

    // æ£€æŸ¥æ‹¾å–è€…æ˜¯å¦æ˜¯æ•Œæ–¹é˜Ÿä¼
    // ï¼ˆå®é™…é¡¹ç›®ä¸­åº”é€šè¿‡ TeamSubsystem åˆ¤æ–­ï¼‰
    
    Carrier = NewCarrier;
    FlagState = EFlagState::Carried;

    // é™„åŠ æ——å¸œåˆ°è§’è‰²
    if (AActor* FlagActor = GetOwner())
    {
        FlagActor->AttachToActor(NewCarrier, FAttachmentTransformRules::SnapToTargetIncludingScale);
    }

    // æ¸…é™¤æ‰è½è®¡æ—¶å™¨
    GetWorld()->GetTimerManager().ClearTimer(DropTimerHandle);

    return true;
}

void UCTFFlagComponent::DropFlag()
{
    if (!GetOwner()->HasAuthority())
    {
        return;
    }

    if (FlagState != EFlagState::Carried)
    {
        return;
    }

    // åˆ†ç¦»æ——å¸œ
    if (AActor* FlagActor = GetOwner())
    {
        FlagActor->DetachFromActor(FDetachmentTransformRules::KeepWorldTransform);
    }

    Carrier = nullptr;
    FlagState = EFlagState::Dropped;

    // å¯åŠ¨è‡ªåŠ¨å½’è¿˜è®¡æ—¶å™¨
    GetWorld()->GetTimerManager().SetTimer(
        DropTimerHandle,
        this,
        &UCTFFlagComponent::OnDropTimeout,
        AutoReturnTime,
        false
    );
}

bool UCTFFlagComponent::AttemptScore(AActor* ScoringActor)
{
    if (!GetOwner()->HasAuthority())
    {
        return false;
    }

    if (Carrier != ScoringActor || FlagState != EFlagState::Carried)
    {
        return false; // å¿…é¡»æ˜¯æºå¸¦è€…ä¸”æ——å¸œåœ¨æºå¸¦çŠ¶æ€
    }

    // æ£€æŸ¥æ˜¯å¦åœ¨å·±æ–¹åŸºåœ°èŒƒå›´å†…
    // ï¼ˆç®€åŒ–å®ç°ï¼Œå®é™…åº”æ£€æŸ¥ä¸åŸºåœ°çš„è·ç¦»ï¼‰
    
    // è·å– GameState å¹¶å¢åŠ å¾—åˆ†
    if (ACTFGameState* CTFGameState = GetWorld()->GetGameState<ACTFGameState>())
    {
        // è·å–å¾—åˆ†é˜Ÿä¼ IDï¼ˆæºå¸¦è€…çš„é˜Ÿä¼ï¼‰
        int32 ScoringTeamId = 0; // åº”ä» TeamSubsystem è·å–
        CTFGameState->AddTeamScore(ScoringTeamId, 1);
    }

    // å½’è¿˜æ——å¸œ
    ReturnToBase();

    return true;
}

void UCTFFlagComponent::ReturnToBase()
{
    if (!GetOwner()->HasAuthority())
    {
        return;
    }

    // åˆ†ç¦»æ——å¸œ
    if (AActor* FlagActor = GetOwner())
    {
        FlagActor->DetachFromActor(FDetachmentTransformRules::KeepWorldTransform);
        FlagActor->SetActorLocation(BaseLocation);
    }

    Carrier = nullptr;
    FlagState = EFlagState::AtBase;

    // æ¸…é™¤è®¡æ—¶å™¨
    GetWorld()->GetTimerManager().ClearTimer(DropTimerHandle);
}
```

### æ­¥éª¤ 5ï¼šé…ç½® Experience ä½¿ç”¨æ’ä»¶

å›åˆ° `B_CTFExperience`ï¼Œç¡®ä¿é…ç½®äº†ï¼š

```
Game Features To Enable:
  - CTFGameMode
  - ShooterCore  // æä¾›å°„å‡»èƒ½åŠ›
  
Actions:
  - Add Abilities (é…ç½® GA_PickupFlag ç­‰èƒ½åŠ›)
  - Add Widget (æ·»åŠ  W_CTFScoreboard åˆ° HUD)
  
Action Sets:
  - AS_SharedUI  // å…±äº«çš„åŸºç¡€ UI
```

### æ­¥éª¤ 6ï¼šæµ‹è¯•è¿è¡Œ

1. åˆ›å»ºä¸€ä¸ªæµ‹è¯•åœ°å›¾ `L_CTFTest`
2. è®¾ç½® World Settings çš„ Default GameMode ä¸º `LyraGameMode`
3. åœ¨åœ°å›¾ä¸­æ”¾ç½® `LyraPlayerStart`ï¼ˆåˆ†é…ä¸åŒé˜Ÿä¼ï¼‰
4. æ”¾ç½®æ——å¸œåŸºåœ° Actorï¼ˆBP_FlagBaseï¼‰
5. è®¾ç½® Experience ä¸º `B_CTFExperience`
6. PIE æµ‹è¯•

**è®¾ç½® Experience çš„æ–¹å¼ï¼š**

æ–¹å¼ 1ï¼šé€šè¿‡ World Settings
```
World Settings â†’ Lyra â†’ Default Experience: B_CTFExperience
```

æ–¹å¼ 2ï¼šé€šè¿‡å‘½ä»¤è¡Œ
```
UnrealEditor.exe YourProject.uproject /Game/Maps/L_CTFTest?Experience=B_CTFExperience
```

æ–¹å¼ 3ï¼šä»£ç è®¾ç½®ï¼ˆåœ¨ GameMode ä¸­ï¼‰
```cpp
void ALyraGameMode::InitGame(const FString& MapName, const FString& Options, FString& ErrorMessage)
{
    Super::InitGame(MapName, Options, ErrorMessage);

    // è§£æ URL å‚æ•°
    FString ExperienceName = UGameplayStatics::ParseOption(Options, TEXT("Experience"));
    if (ExperienceName.IsEmpty())
    {
        ExperienceName = TEXT("B_CTFExperience"); // é»˜è®¤ Experience
    }

    // è®¾ç½® Experience
    ULyraExperienceManagerComponent* ExperienceComponent = GameState->FindComponentByClass<ULyraExperienceManagerComponent>();
    if (ExperienceComponent)
    {
        FPrimaryAssetId ExperienceId = FPrimaryAssetId(FPrimaryAssetType("LyraExperienceDefinition"), FName(*ExperienceName));
        ExperienceComponent->SetCurrentExperience(ExperienceId);
    }
}
```

---

## ğŸŒŸ Experience ç³»ç»Ÿçš„é«˜çº§åº”ç”¨

### 1. åŠ¨æ€åˆ‡æ¢ Experience

è™½ç„¶ Lyra å®˜æ–¹ç¤ºä¾‹æ²¡æœ‰ç›´æ¥æ”¯æŒï¼Œä½†ç†è®ºä¸Šå¯ä»¥å®ç°è¿è¡Œæ—¶åˆ‡æ¢ï¼š

```cpp
void ASomeGameMode::SwitchExperience(FPrimaryAssetId NewExperienceId)
{
    ULyraExperienceManagerComponent* ExperienceComponent = GameState->FindComponentByClass<ULyraExperienceManagerComponent>();
    if (!ExperienceComponent)
    {
        return;
    }

    // 1. å¸è½½å½“å‰ Experience
    ExperienceComponent->DeactivateCurrentExperience();

    // 2. æ¸…ç†æ—§çš„ Actor å’Œç»„ä»¶
    // ï¼ˆéœ€è¦éå†å¹¶æ¸…ç†ç”±æ—§ Experience æ·»åŠ çš„å†…å®¹ï¼‰

    // 3. åŠ è½½æ–° Experience
    ExperienceComponent->SetCurrentExperience(NewExperienceId);

    // 4. é‡æ–°ç”Ÿæˆ Player Pawns
    for (FConstPlayerControllerIterator It = GetWorld()->GetPlayerControllerIterator(); It; ++It)
    {
        if (APlayerController* PC = It->Get())
        {
            RestartPlayer(PC);
        }
    }
}
```

**æŒ‘æˆ˜ï¼š**
- éœ€è¦æ¸…ç†æ—§ Experience æ·»åŠ çš„æ‰€æœ‰èµ„æº
- ç½‘ç»œåŒæ­¥çš„å¤æ‚æ€§
- çŠ¶æ€ä¿æŒï¼ˆç©å®¶å¾—åˆ†ã€èƒŒåŒ…ç­‰ï¼‰

### 2. Experience ç»§æ‰¿å’Œç»„åˆ

é€šè¿‡ ActionSet å¯ä»¥å®ç°ç±»ä¼¼"ç»§æ‰¿"çš„æ•ˆæœï¼š

```
BaseShooterExperience (åŸºç¡€å°„å‡»ç©æ³•)
  â”œâ”€ Actions: ç§»åŠ¨ã€è·³è·ƒã€å°„å‡»
  â”œâ”€ ActionSets: AS_BasicUI, AS_TeamSystem
  â””â”€ GameFeatures: ShooterCore

TeamDeathmatchExperience (ç»§æ‰¿åŸºç¡€ + TDM è§„åˆ™)
  â”œâ”€ Actions: é‡ç”Ÿè®¡æ—¶å™¨ã€å‡»æ€ç»Ÿè®¡
  â”œâ”€ ActionSets: AS_BaseShooterExperience  â† å¤ç”¨ï¼
  â””â”€ GameFeatures: TDMGameMode

FreeForAllExperience (ç»§æ‰¿åŸºç¡€ + FFA è§„åˆ™)
  â”œâ”€ Actions: ä¸ªäººç§¯åˆ†æ¦œ
  â”œâ”€ ActionSets: AS_BaseShooterExperience  â† å¤ç”¨ï¼
  â””â”€ GameFeatures: FFAGameMode
```

**ä¼˜åŠ¿ï¼š**
- å‡å°‘é‡å¤é…ç½®
- ç»Ÿä¸€ç»´æŠ¤åŸºç¡€åŠŸèƒ½
- å¿«é€Ÿè¿­ä»£æ–°æ¨¡å¼

### 3. Experience ä¸ Game Phase è”åŠ¨

åœ¨å¤æ‚æ¸¸æˆä¸­ï¼ŒExperience é€šå¸¸ä¸ Game Phase ç³»ç»Ÿé…åˆï¼š

```cpp
// åœ¨ Experience çš„ Action ä¸­æ³¨å†Œ Phase Ability
UCLASS()
class UGameFeatureAction_AddPhases : public UGameFeatureAction_WorldActionBase
{
    GENERATED_BODY()

public:
    UPROPERTY(EditAnywhere)
    TArray<TSoftClassPtr<ULyraGamePhaseAbility>> PhaseAbilities;

    virtual void AddToWorld(const FWorldContext& WorldContext, const FGameFeatureStateChangeContext& ChangeContext) override
    {
        ULyraGamePhaseSubsystem* PhaseSubsystem = WorldContext.World()->GetSubsystem<ULyraGamePhaseSubsystem>();
        if (PhaseSubsystem)
        {
            for (const TSoftClassPtr<ULyraGamePhaseAbility>& PhaseAbilityClass : PhaseAbilities)
            {
                if (!PhaseAbilityClass.IsNull())
                {
                    TSubclassOf<ULyraGamePhaseAbility> LoadedClass = PhaseAbilityClass.LoadSynchronous();
                    PhaseSubsystem->RegisterPhaseAbility(LoadedClass);
                }
            }
        }
    }
};
```

**åº”ç”¨åœºæ™¯ï¼š**
- æˆ˜æ–—å‡†å¤‡é˜¶æ®µ â†’ æˆ˜æ–—é˜¶æ®µ â†’ ç»“ç®—é˜¶æ®µ
- ç™½å¤© â†’ é»‘å¤œå¾ªç¯ï¼ˆPvE æ¨¡å¼ï¼‰
- æ³¢æ¬¡ç”Ÿæˆï¼ˆå¡”é˜²æ¨¡å¼ï¼‰

### 4. å¤šäººæ¸¸æˆçš„ Experience åŒæ­¥

åœ¨å¤šäººæ¸¸æˆä¸­ï¼ŒExperience å¿…é¡»åœ¨æ‰€æœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼š

```cpp
// GameState ä¸­
UPROPERTY(ReplicatedUsing=OnRep_CurrentExperience)
TObjectPtr<const ULyraExperienceDefinition> CurrentExperience;

void ULyraExperienceManagerComponent::OnRep_CurrentExperience()
{
    // å®¢æˆ·ç«¯æ”¶åˆ° Experience å˜åŒ–
    if (CurrentExperience)
    {
        StartExperienceLoad(); // å®¢æˆ·ç«¯ä¹Ÿæ‰§è¡ŒåŠ è½½æµç¨‹
    }
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- Experience å¿…é¡»åœ¨æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯ç”¨ï¼ˆæ‰“åŒ…æ—¶åŒ…å«ï¼‰
- å®¢æˆ·ç«¯åŠ è½½é€Ÿåº¦å¯èƒ½ä¸ä¸€è‡´ï¼Œéœ€è¦ç­‰å¾…æœºåˆ¶
- ä½¿ç”¨ `ILoadingProcessInterface` æ˜¾ç¤ºåŠ è½½ç”»é¢

---

## ğŸ“Š Experience ç³»ç»Ÿçš„æ€§èƒ½è€ƒé‡

### 1. å¼‚æ­¥åŠ è½½ä¼˜åŒ–

Lyra ä½¿ç”¨ Asset Manager çš„ Bundle ç³»ç»Ÿå®ç°åˆ†çº§åŠ è½½ï¼š

```cpp
// åœ¨ Experience Definition ä¸­å®šä¹‰èµ„äº§åŒ…
void ULyraExperienceDefinition::UpdateAssetBundleData()
{
    Super::UpdateAssetBundleData();

    // å®šä¹‰ Client å’Œ Server åŒ…
    FAssetBundleData BundleData;
    
    // Client åŒ…ï¼šåŒ…å«æ¨¡å‹ã€æè´¨ã€éŸ³æ•ˆã€UI ç­‰
    BundleData.AddBundleAsset(UGameFeaturesSubsystemSettings::LoadStateClient, ...);
    
    // Server åŒ…ï¼šåªåŒ…å«é€»è¾‘å’Œæ•°æ®
    BundleData.AddBundleAsset(UGameFeaturesSubsystemSettings::LoadStateServer, ...);

    SetAssetBundleData(BundleData);
}
```

**å»ºè®®ï¼š**
- æœåŠ¡å™¨ä¸è¦åŠ è½½å®¢æˆ·ç«¯èµ„äº§ï¼ˆæ¨¡å‹ã€æè´¨ï¼‰
- ä½¿ç”¨è½¯å¼•ç”¨ï¼ˆTSoftObjectPtrï¼‰è€Œä¸æ˜¯ç¡¬å¼•ç”¨
- åˆ†é˜¶æ®µåŠ è½½ï¼šæ ¸å¿ƒç©æ³• â†’ è¡¨ç°å±‚ â†’ å¯é€‰å†…å®¹

### 2. Game Feature æ’ä»¶çš„å¸è½½

è™½ç„¶ Lyra ç›®å‰æ²¡æœ‰å®Œæ•´å®ç°æ’ä»¶å¸è½½ï¼Œä½†è®¾è®¡ä¸Šæ”¯æŒï¼š

```cpp
void UGameFeatureAction_AddAbilities::OnGameFeatureDeactivating(FGameFeatureDeactivatingContext& Context)
{
    FPerContextData* ActiveData = ContextData.Find(Context);
    if (ActiveData)
    {
        Reset(*ActiveData); // æ¸…ç†æ‰€æœ‰æ‰©å±•
    }
}

void UGameFeatureAction_AddAbilities::Reset(FPerContextData& ActiveData)
{
    // éå†æ‰€æœ‰ Actorï¼Œç§»é™¤æ·»åŠ çš„ Ability
    for (auto& Pair : ActiveData.ActiveExtensions)
    {
        RemoveActorAbilities(Pair.Key, ActiveData);
    }
    ActiveData.ActiveExtensions.Reset();
}
```

**æœªæ¥æ”¹è¿›æ–¹å‘ï¼š**
- å¼•ç”¨è®¡æ•°ï¼šå½“æ’ä»¶è¢«å¤šä¸ª Experience å…±äº«æ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªå¸è½½æ—¶æ‰çœŸæ­£æ¸…ç†
- èµ„äº§ç¼“å­˜ï¼šé¢‘ç¹ä½¿ç”¨çš„æ’ä»¶ä¿æŒåŠ è½½çŠ¶æ€
- ä¼˜é›…é™çº§ï¼šæ’ä»¶å¸è½½å¤±è´¥æ—¶çš„å›é€€æœºåˆ¶

### 3. å†…å­˜å ç”¨ç›‘æ§

ä½¿ç”¨ Unreal Insights ç›‘æ§ Experience çš„å†…å­˜ä½¿ç”¨ï¼š

```bash
# å¯ç”¨å†…å­˜è¿½è¸ª
-trace=memory,loadtime

# åœ¨æ¸¸æˆä¸­æ‰§è¡Œå‘½ä»¤
obj list class=LyraExperienceDefinition
obj list class=GameFeatureAction

# æŸ¥çœ‹æ’ä»¶çŠ¶æ€
GameFeatures.ShowPluginsState
```

---

## ğŸš€ æ€»ç»“ä¸æœ€ä½³å®è·µ

### Experience ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼

1. **è§£è€¦æ¸¸æˆæ¨¡å¼å’Œå†…å®¹**
   - ä¸åŒæ¨¡å¼å¯ä»¥å…±äº«åº•å±‚ç³»ç»Ÿï¼ˆGASã€è¾“å…¥ã€UIï¼‰
   - å†…å®¹ä»¥æ’ä»¶å½¢å¼ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒ

2. **æ•°æ®é©±åŠ¨çš„è®¾è®¡**
   - ç­–åˆ’å¯ä»¥é€šè¿‡é…ç½®åˆ›å»ºæ–°æ¨¡å¼
   - å‡å°‘ç¨‹åºå‘˜çš„è¿­ä»£è´Ÿæ‹…

3. **è¿è¡Œæ—¶çµæ´»æ€§**
   - åŠ¨æ€åŠ è½½/å¸è½½å†…å®¹
   - æ”¯æŒçƒ­æ›´æ–°å’Œ DLC

### å¼€å‘å»ºè®®

#### âœ… DO

1. **åˆç†åˆ’åˆ†æ’ä»¶è¾¹ç•Œ**
   - ä¸€ä¸ª Game Feature å¯¹åº”ä¸€ä¸ªç‹¬ç«‹ç©æ³•æˆ–åŠŸèƒ½æ¨¡å—
   - é¿å…æ’ä»¶é—´çš„ç¡¬ä¾èµ–

2. **å¤ç”¨ ActionSet**
   - æŠŠé€šç”¨é…ç½®ï¼ˆå¦‚ UIã€è¾“å…¥ï¼‰æŠ½å–ä¸º ActionSet
   - å‡å°‘é‡å¤é…ç½®

3. **ä½¿ç”¨è½¯å¼•ç”¨**
   - æ‰€æœ‰è·¨æ’ä»¶çš„å¼•ç”¨éƒ½ç”¨ `TSoftObjectPtr`
   - é¿å…å¾ªç¯ä¾èµ–

4. **æµ‹è¯• Experience åˆ‡æ¢**
   - ç¡®ä¿èµ„æºæ­£ç¡®åŠ è½½å’Œå¸è½½
   - æ£€æŸ¥å†…å­˜æ³„æ¼

#### âŒ DON'T

1. **ä¸è¦åœ¨ Experience ä¸­å†™ä¸šåŠ¡é€»è¾‘**
   - Experience åªæ˜¯é…ç½®ï¼Œé€»è¾‘åº”åœ¨ GameState/GameMode/Subsystem ä¸­

2. **ä¸è¦ç¡¬ç¼–ç  Experience ID**
   - ä½¿ç”¨é…ç½®è¡¨æˆ–æšä¸¾ç®¡ç†
   - æ”¯æŒå¤–éƒ¨ä¼ å…¥ï¼ˆURL å‚æ•°ï¼‰

3. **ä¸è¦å¿½è§†ç½‘ç»œåŒæ­¥**
   - Experience çš„åŠ è½½å¿…é¡»åœ¨æ‰€æœ‰å®¢æˆ·ç«¯åŒæ­¥å®Œæˆ
   - ä½¿ç”¨åŠ è½½ç•Œé¢é®ç›–å¼‚æ­¥è¿‡ç¨‹

4. **ä¸è¦è¿‡åº¦æ‹†åˆ†æ’ä»¶**
   - å¤ªå¤šå°æ’ä»¶ä¼šå¢åŠ ç®¡ç†æˆæœ¬
   - æ‰¾åˆ°åˆé€‚çš„ç²’åº¦

### è°ƒè¯•æŠ€å·§

#### 1. æ—¥å¿—è¿½è¸ª

```cpp
// åœ¨é¡¹ç›®çš„ LogChannels ä¸­å®šä¹‰
LYRAGAME_API DECLARE_LOG_CATEGORY_EXTERN(LogLyraExperience, Log, All);

// æŸ¥çœ‹ Experience åŠ è½½æ—¥å¿—
UE_LOG(LogLyraExperience, Log, TEXT("Loading Experience: %s"), *ExperienceId.ToString());
```

#### 2. æ§åˆ¶å°å‘½ä»¤

```bash
# æ˜¾ç¤ºå½“å‰ Experience
Lyra.Experience.Current

# å¼ºåˆ¶é‡æ–°åŠ è½½ Experience
Lyra.Experience.Reload

# æ˜¾ç¤ºæ‰€æœ‰ Game Feature çŠ¶æ€
GameFeatures.ShowPluginsState
```

#### 3. æ–­ç‚¹ä½ç½®

å…³é”®æ–­ç‚¹ä½ç½®ï¼š
- `ULyraExperienceManagerComponent::SetCurrentExperience` - å¼€å§‹åŠ è½½
- `ULyraExperienceManagerComponent::OnExperienceLoadComplete` - èµ„äº§åŠ è½½å®Œæˆ
- `ULyraExperienceManagerComponent::OnExperienceFullLoadCompleted` - æ’ä»¶åŠ è½½å®Œæˆ
- `UGameFeatureAction::OnGameFeatureActivating` - Action æ‰§è¡Œ

---

## ğŸ”— ç›¸å…³é˜…è¯»

- **ä¸Šä¸€ç¯‡**ï¼š[æ¨¡å—åŒ– Actor ç»„ä»¶ç³»ç»Ÿè¯¦è§£](02-modular-actor-components.md)
- **ä¸‹ä¸€ç¯‡**ï¼š[Game Featuresï¼šæ’ä»¶åŒ–æ¸¸æˆå†…å®¹](04-game-features.md)
- **è¿›é˜¶**ï¼š[è‡ªå®šä¹‰ Game Feature Action](../05-advanced-topics/27-custom-game-feature-action.md)

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [UE5 Game Features æ’ä»¶æ–‡æ¡£](https://docs.unrealengine.com/5.0/game-features-and-modular-gameplay-in-unreal-engine/)
- [Asset Manager æŒ‡å—](https://docs.unrealengine.com/5.0/asset-management-in-unreal-engine/)
- [Lyra Sample Game æ–‡æ¡£](https://docs.unrealengine.com/5.0/lyra-sample-game-in-unreal-engine/)

### ç¤¾åŒºèµ„æº
- [Epic Games Lyra GitHub](https://github.com/EpicGames/UnrealEngine/tree/5.0/Samples/Games/Lyra)
- [Lyra ä¸­æ–‡ç¤¾åŒºè®ºå›](https://forums.unrealengine.com/c/chinese-chinese/chinese-documentation)

### è§†é¢‘æ•™ç¨‹
- [Lyra Overview - Unreal Sensei](https://www.youtube.com/watch?v=...)
- [Game Features Deep Dive - Epic Developer](https://www.youtube.com/watch?v=...)

---

## ğŸ¤ è´¡çŒ®ä¸åé¦ˆ

å‘ç°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Ÿæ¬¢è¿ï¼š
- æäº¤ Issueï¼š[GitHub Issues](https://github.com/your-repo/issues)
- å‚ä¸è®¨è®ºï¼š[Discord ç¤¾åŒº](https://discord.gg/your-community)
- åˆ†äº«æ¡ˆä¾‹ï¼šå°†ä½ çš„ Experience å®ç°åˆ†äº«åˆ°ç¤¾åŒºï¼

---

**ä¸‹ä¸€ç¯‡é¢„å‘Š**ï¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ **Game Features æ’ä»¶ç³»ç»Ÿ**ï¼Œå­¦ä¹ å¦‚ä½•åˆ›å»ºã€é…ç½®å’Œç®¡ç†æ’ä»¶ï¼Œä»¥åŠå¦‚ä½•å®ç°æ’ä»¶é—´çš„ä¾èµ–ç®¡ç†ã€‚æ•¬è¯·æœŸå¾…ï¼

---

*æœ€åæ›´æ–°ï¼š2026-02-12*  
*ä½œè€…ï¼šLyra æ•™ç¨‹å›¢é˜Ÿ*  
*ç‰ˆæƒæ‰€æœ‰ Â© 2026 ä¿ç•™æ‰€æœ‰æƒåˆ©*
